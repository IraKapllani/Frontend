{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\iraka\\\\OneDrive\\\\Desktop\\\\ira-front\\\\src\\\\App.js\";\nimport './theme/styles.css';\nimport { BrowserRouter, Route, Routes } from \"react-router-dom\";\nimport Home from './screens/Home';\nimport Books from './screens/Books';\nimport Addauthors from './screens/AddAuthors';\nimport { Login } from './screens/Login';\nimport { useState } from 'react';\nimport { Sidebar } from './components/Sidebar';\nimport React, { Component, Fragment } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass App extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      showBackdrop: false,\n      showMobileNav: false,\n      isAuth: true,\n      token: null,\n      userId: null,\n      authLoading: false,\n      error: null\n    };\n\n    this.logoutHandler = () => {\n      this.setState({\n        isAuth: false,\n        token: null\n      });\n      localStorage.removeItem('token');\n      localStorage.removeItem('expiryDate');\n      localStorage.removeItem('userId');\n    };\n\n    this.loginHandler = (event, authData) => {\n      event.preventDefault();\n      this.setState({\n        authLoading: true\n      });\n      fetch('http://localhost:3001/login').then(res => {\n        if (res.status === 422) {\n          throw new Error('Validation failed.');\n        }\n\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Could not authenticate you!');\n        }\n\n        return res.json();\n      }).then(resData => {\n        console.log(resData);\n        this.setState({\n          isAuth: true,\n          token: resData.token,\n          authLoading: false,\n          userId: resData.userId\n        });\n        localStorage.setItem('token', resData.token);\n        localStorage.setItem('userId', resData.userId);\n        const remainingMilliseconds = 60 * 60 * 1000;\n        const expiryDate = new Date(new Date().getTime() + remainingMilliseconds);\n        localStorage.setItem('expiryDate', expiryDate.toISOString());\n        this.setAutoLogout(remainingMilliseconds);\n      }).catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    this.setAutoLogout = milliseconds => {\n      setTimeout(() => {\n        this.logoutHandler();\n      }, milliseconds);\n    };\n\n    this.errorHandler = () => {\n      this.setState({\n        error: null\n      });\n    };\n  }\n\n  componentDidMount() {\n    const token = localStorage.getItem('token');\n    const expiryDate = localStorage.getItem('expiryDate');\n\n    if (!token || !expiryDate) {\n      return;\n    }\n\n    if (new Date(expiryDate) <= new Date()) {\n      this.logoutHandler();\n      return;\n    }\n\n    const userId = localStorage.getItem('userId');\n    const remainingMilliseconds = new Date(expiryDate).getTime() - new Date().getTime();\n    this.setState({\n      isAuth: true,\n      token: token,\n      userId: userId\n    });\n    this.setAutoLogout(remainingMilliseconds);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: /*#__PURE__*/_jsxDEV(BrowserRouter, {\n        children: [/*#__PURE__*/_jsxDEV(Sidebar, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"content\",\n          children: /*#__PURE__*/_jsxDEV(Routes, {\n            children: [/*#__PURE__*/_jsxDEV(Route, {\n              path: \"/login\",\n              exact: true,\n              render: props => /*#__PURE__*/_jsxDEV(Login, { ...props,\n                onLogin: this.loginHandler,\n                loading: this.state.authLoading\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 116,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 112,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"/\",\n              element: /*#__PURE__*/_jsxDEV(Home, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 123,\n                columnNumber: 38\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"books\",\n              element: /*#__PURE__*/_jsxDEV(Books, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 124,\n                columnNumber: 42\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 124,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"add-authors\",\n              element: /*#__PURE__*/_jsxDEV(Addauthors, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 125,\n                columnNumber: 48\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 125,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default _c = withRouter(App);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["C:/Users/iraka/OneDrive/Desktop/ira-front/src/App.js"],"names":["BrowserRouter","Route","Routes","Home","Books","Addauthors","Login","useState","Sidebar","React","Component","Fragment","withRouter","App","state","showBackdrop","showMobileNav","isAuth","token","userId","authLoading","error","logoutHandler","setState","localStorage","removeItem","loginHandler","event","authData","preventDefault","fetch","then","res","status","Error","console","log","json","resData","setItem","remainingMilliseconds","expiryDate","Date","getTime","toISOString","setAutoLogout","catch","err","milliseconds","setTimeout","errorHandler","componentDidMount","getItem","render","props"],"mappings":"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","sourcesContent":["import './theme/styles.css';\r\nimport {\r\n  BrowserRouter,\r\n  Route,\r\n  Routes\r\n} from \"react-router-dom\";\r\nimport Home from './screens/Home';\r\nimport Books from './screens/Books';\r\nimport Addauthors from './screens/AddAuthors';\r\nimport { Login } from './screens/Login';\r\nimport { useState } from 'react';\r\nimport { Sidebar } from './components/Sidebar';\r\nimport React, { Component, Fragment } from 'react';\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nclass App extends Component {\r\n  state = {\r\n    showBackdrop: false,\r\n    showMobileNav: false,\r\n    isAuth: true,\r\n    token: null,\r\n    userId: null,\r\n    authLoading: false,\r\n    error: null\r\n  };\r\n\r\n  componentDidMount() {\r\n    const token = localStorage.getItem('token');\r\n    const expiryDate = localStorage.getItem('expiryDate');\r\n    if (!token || !expiryDate) {\r\n      return;\r\n    }\r\n    if (new Date(expiryDate) <= new Date()) {\r\n      this.logoutHandler();\r\n      return;\r\n    }\r\n    const userId = localStorage.getItem('userId');\r\n    const remainingMilliseconds =\r\n      new Date(expiryDate).getTime() - new Date().getTime();\r\n    this.setState({ isAuth: true, token: token, userId: userId });\r\n    this.setAutoLogout(remainingMilliseconds);\r\n  }\r\n\r\n  logoutHandler = () => {\r\n    this.setState({ isAuth: false, token: null });\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('expiryDate');\r\n    localStorage.removeItem('userId');\r\n  };\r\n\r\n  loginHandler = (event, authData) => {\r\n    event.preventDefault();\r\n    this.setState({ authLoading: true });\r\n    fetch('http://localhost:3001/login')\r\n      .then(res => {\r\n        if (res.status === 422) {\r\n          throw new Error('Validation failed.');\r\n        }\r\n        if (res.status !== 200 && res.status !== 201) {\r\n          console.log('Error!');\r\n          throw new Error('Could not authenticate you!');\r\n        }\r\n        return res.json();\r\n      })\r\n      .then(resData => {\r\n        console.log(resData);\r\n        this.setState({\r\n          isAuth: true,\r\n          token: resData.token,\r\n          authLoading: false,\r\n          userId: resData.userId\r\n        });\r\n        localStorage.setItem('token', resData.token);\r\n        localStorage.setItem('userId', resData.userId);\r\n        const remainingMilliseconds = 60 * 60 * 1000;\r\n        const expiryDate = new Date(\r\n          new Date().getTime() + remainingMilliseconds\r\n        );\r\n        localStorage.setItem('expiryDate', expiryDate.toISOString());\r\n        this.setAutoLogout(remainingMilliseconds);\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n        this.setState({\r\n          isAuth: false,\r\n          authLoading: false,\r\n          error: err\r\n        });\r\n      });\r\n  };\r\n\r\n\r\n  setAutoLogout = milliseconds => {\r\n    setTimeout(() => {\r\n      this.logoutHandler();\r\n    }, milliseconds);\r\n  };\r\n\r\n  errorHandler = () => {\r\n    this.setState({ error: null });\r\n  };\r\n\r\n  render() {\r\n  \r\n     \r\n    return (\r\n      <div className=\"container\">\r\n      <BrowserRouter>\r\n        <Sidebar />\r\n        <div id='content'>\r\n          <Routes>\r\n          <Route\r\n          path=\"/login\"\r\n          exact\r\n          render={props => (\r\n            <Login\r\n              {...props}\r\n              onLogin={this.loginHandler}\r\n              loading={this.state.authLoading}\r\n            />\r\n          )}\r\n        />\r\n            <Route path=\"/\" element={<Home />} />\r\n            <Route path=\"books\" element={<Books />} />\r\n            <Route path=\"add-authors\" element={<Addauthors />} />\r\n          </Routes>\r\n        </div>\r\n      </BrowserRouter>\r\n    </div>\r\n      \r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(App);\r\n\r\n"]},"metadata":{},"sourceType":"module"}