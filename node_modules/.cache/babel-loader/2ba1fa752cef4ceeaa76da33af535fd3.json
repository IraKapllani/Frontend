{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\iraka\\\\OneDrive\\\\Desktop\\\\ira-front\\\\src\\\\App.js\";\nimport './theme/styles.css';\nimport { BrowserRouter, Route, Routes } from \"react-router-dom\";\nimport Home from './screens/Home';\nimport Books from './screens/Books';\nimport Addauthors from './screens/AddAuthors';\nimport { Login } from './screens/Login';\nimport { useState } from 'react';\nimport { Sidebar } from './components/Sidebar';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass App extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      showBackdrop: false,\n      showMobileNav: false,\n      isAuth: true,\n      token: null,\n      userId: null,\n      authLoading: false,\n      error: null\n    };\n\n    this.mobileNavHandler = isOpen => {\n      this.setState({\n        showMobileNav: isOpen,\n        showBackdrop: isOpen\n      });\n    };\n\n    this.backdropClickHandler = () => {\n      this.setState({\n        showBackdrop: false,\n        showMobileNav: false,\n        error: null\n      });\n    };\n\n    this.logoutHandler = () => {\n      this.setState({\n        isAuth: false,\n        token: null\n      });\n      localStorage.removeItem('token');\n      localStorage.removeItem('expiryDate');\n      localStorage.removeItem('userId');\n    };\n\n    this.loginHandler = (event, authData) => {\n      event.preventDefault();\n      this.setState({\n        authLoading: true\n      });\n      fetch('URL').then(res => {\n        if (res.status === 422) {\n          throw new Error('Validation failed.');\n        }\n\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Could not authenticate you!');\n        }\n\n        return res.json();\n      }).then(resData => {\n        console.log(resData);\n        this.setState({\n          isAuth: true,\n          token: resData.token,\n          authLoading: false,\n          userId: resData.userId\n        });\n        localStorage.setItem('token', resData.token);\n        localStorage.setItem('userId', resData.userId);\n        const remainingMilliseconds = 60 * 60 * 1000;\n        const expiryDate = new Date(new Date().getTime() + remainingMilliseconds);\n        localStorage.setItem('expiryDate', expiryDate.toISOString());\n        this.setAutoLogout(remainingMilliseconds);\n      }).catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    this.signupHandler = (event, authData) => {\n      event.preventDefault();\n      this.setState({\n        authLoading: true\n      });\n      fetch('URL').then(res => {\n        if (res.status === 422) {\n          throw new Error(\"Validation failed. Make sure the email address isn't used yet!\");\n        }\n\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Creating a user failed!');\n        }\n\n        return res.json();\n      }).then(resData => {\n        console.log(resData);\n        this.setState({\n          isAuth: false,\n          authLoading: false\n        });\n        this.props.history.replace('/');\n      }).catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    this.setAutoLogout = milliseconds => {\n      setTimeout(() => {\n        this.logoutHandler();\n      }, milliseconds);\n    };\n\n    this.errorHandler = () => {\n      this.setState({\n        error: null\n      });\n    };\n  }\n\n  componentDidMount() {\n    const token = localStorage.getItem('token');\n    const expiryDate = localStorage.getItem('expiryDate');\n\n    if (!token || !expiryDate) {\n      return;\n    }\n\n    if (new Date(expiryDate) <= new Date()) {\n      this.logoutHandler();\n      return;\n    }\n\n    const userId = localStorage.getItem('userId');\n    const remainingMilliseconds = new Date(expiryDate).getTime() - new Date().getTime();\n    this.setState({\n      isAuth: true,\n      token: token,\n      userId: userId\n    });\n    this.setAutoLogout(remainingMilliseconds);\n  }\n\n  render() {\n    let routes = /*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(Route, {\n        path: \"/\",\n        exact: true,\n        render: props => /*#__PURE__*/_jsxDEV(LoginPage, { ...props,\n          onLogin: this.loginHandler,\n          loading: this.state.authLoading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/signup\",\n        exact: true,\n        render: props => /*#__PURE__*/_jsxDEV(SignupPage, { ...props,\n          onSignup: this.signupHandler,\n          loading: this.state.authLoading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }, this);\n\n    if (this.state.isAuth) {\n      routes = /*#__PURE__*/_jsxDEV(Switch, {\n        children: [/*#__PURE__*/_jsxDEV(Route, {\n          path: \"/\",\n          exact: true,\n          render: props => /*#__PURE__*/_jsxDEV(FeedPage, {\n            userId: this.state.userId,\n            token: this.state.token\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/:postId\",\n          render: props => /*#__PURE__*/_jsxDEV(SinglePostPage, { ...props,\n            userId: this.state.userId,\n            token: this.state.token\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Redirect, {\n          to: \"/\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(Fragment, {\n      children: [this.state.showBackdrop && /*#__PURE__*/_jsxDEV(Backdrop, {\n        onClick: this.backdropClickHandler\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(ErrorHandler, {\n        error: this.state.error,\n        onHandle: this.errorHandler\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Layout, {\n        header: /*#__PURE__*/_jsxDEV(Toolbar, {\n          children: /*#__PURE__*/_jsxDEV(MainNavigation, {\n            onOpenMobileNav: this.mobileNavHandler.bind(this, true),\n            onLogout: this.logoutHandler,\n            isAuth: this.state.isAuth\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 13\n        }, this),\n        mobileNav: /*#__PURE__*/_jsxDEV(MobileNavigation, {\n          open: this.state.showMobileNav,\n          mobile: true,\n          onChooseItem: this.mobileNavHandler.bind(this, false),\n          onLogout: this.logoutHandler,\n          isAuth: this.state.isAuth\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }, this), routes]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default _c = withRouter(App);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["C:/Users/iraka/OneDrive/Desktop/ira-front/src/App.js"],"names":["BrowserRouter","Route","Routes","Home","Books","Addauthors","Login","useState","Sidebar","App","Component","state","showBackdrop","showMobileNav","isAuth","token","userId","authLoading","error","mobileNavHandler","isOpen","setState","backdropClickHandler","logoutHandler","localStorage","removeItem","loginHandler","event","authData","preventDefault","fetch","then","res","status","Error","console","log","json","resData","setItem","remainingMilliseconds","expiryDate","Date","getTime","toISOString","setAutoLogout","catch","err","signupHandler","props","history","replace","milliseconds","setTimeout","errorHandler","componentDidMount","getItem","render","routes","bind","withRouter"],"mappings":"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","sourcesContent":["import './theme/styles.css';\r\nimport {\r\n  BrowserRouter,\r\n  Route,\r\n  Routes\r\n} from \"react-router-dom\";\r\nimport Home from './screens/Home';\r\nimport Books from './screens/Books';\r\nimport Addauthors from './screens/AddAuthors';\r\nimport { Login } from './screens/Login';\r\nimport { useState } from 'react';\r\nimport { Sidebar } from './components/Sidebar';\r\n\r\nclass App extends Component {\r\n  state = {\r\n    showBackdrop: false,\r\n    showMobileNav: false,\r\n    isAuth: true,\r\n    token: null,\r\n    userId: null,\r\n    authLoading: false,\r\n    error: null\r\n  };\r\n\r\n  componentDidMount() {\r\n    const token = localStorage.getItem('token');\r\n    const expiryDate = localStorage.getItem('expiryDate');\r\n    if (!token || !expiryDate) {\r\n      return;\r\n    }\r\n    if (new Date(expiryDate) <= new Date()) {\r\n      this.logoutHandler();\r\n      return;\r\n    }\r\n    const userId = localStorage.getItem('userId');\r\n    const remainingMilliseconds =\r\n      new Date(expiryDate).getTime() - new Date().getTime();\r\n    this.setState({ isAuth: true, token: token, userId: userId });\r\n    this.setAutoLogout(remainingMilliseconds);\r\n  }\r\n\r\n  mobileNavHandler = isOpen => {\r\n    this.setState({ showMobileNav: isOpen, showBackdrop: isOpen });\r\n  };\r\n\r\n  backdropClickHandler = () => {\r\n    this.setState({ showBackdrop: false, showMobileNav: false, error: null });\r\n  };\r\n\r\n  logoutHandler = () => {\r\n    this.setState({ isAuth: false, token: null });\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('expiryDate');\r\n    localStorage.removeItem('userId');\r\n  };\r\n\r\n  loginHandler = (event, authData) => {\r\n    event.preventDefault();\r\n    this.setState({ authLoading: true });\r\n    fetch('URL')\r\n      .then(res => {\r\n        if (res.status === 422) {\r\n          throw new Error('Validation failed.');\r\n        }\r\n        if (res.status !== 200 && res.status !== 201) {\r\n          console.log('Error!');\r\n          throw new Error('Could not authenticate you!');\r\n        }\r\n        return res.json();\r\n      })\r\n      .then(resData => {\r\n        console.log(resData);\r\n        this.setState({\r\n          isAuth: true,\r\n          token: resData.token,\r\n          authLoading: false,\r\n          userId: resData.userId\r\n        });\r\n        localStorage.setItem('token', resData.token);\r\n        localStorage.setItem('userId', resData.userId);\r\n        const remainingMilliseconds = 60 * 60 * 1000;\r\n        const expiryDate = new Date(\r\n          new Date().getTime() + remainingMilliseconds\r\n        );\r\n        localStorage.setItem('expiryDate', expiryDate.toISOString());\r\n        this.setAutoLogout(remainingMilliseconds);\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n        this.setState({\r\n          isAuth: false,\r\n          authLoading: false,\r\n          error: err\r\n        });\r\n      });\r\n  };\r\n\r\n  signupHandler = (event, authData) => {\r\n    event.preventDefault();\r\n    this.setState({ authLoading: true });\r\n    fetch('URL')\r\n      .then(res => {\r\n        if (res.status === 422) {\r\n          throw new Error(\r\n            \"Validation failed. Make sure the email address isn't used yet!\"\r\n          );\r\n        }\r\n        if (res.status !== 200 && res.status !== 201) {\r\n          console.log('Error!');\r\n          throw new Error('Creating a user failed!');\r\n        }\r\n        return res.json();\r\n      })\r\n      .then(resData => {\r\n        console.log(resData);\r\n        this.setState({ isAuth: false, authLoading: false });\r\n        this.props.history.replace('/');\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n        this.setState({\r\n          isAuth: false,\r\n          authLoading: false,\r\n          error: err\r\n        });\r\n      });\r\n  };\r\n\r\n  setAutoLogout = milliseconds => {\r\n    setTimeout(() => {\r\n      this.logoutHandler();\r\n    }, milliseconds);\r\n  };\r\n\r\n  errorHandler = () => {\r\n    this.setState({ error: null });\r\n  };\r\n\r\n  render() {\r\n    let routes = (\r\n      <Switch>\r\n        <Route\r\n          path=\"/\"\r\n          exact\r\n          render={props => (\r\n            <LoginPage\r\n              {...props}\r\n              onLogin={this.loginHandler}\r\n              loading={this.state.authLoading}\r\n            />\r\n          )}\r\n        />\r\n        <Route\r\n          path=\"/signup\"\r\n          exact\r\n          render={props => (\r\n            <SignupPage\r\n              {...props}\r\n              onSignup={this.signupHandler}\r\n              loading={this.state.authLoading}\r\n            />\r\n          )}\r\n        />\r\n        <Redirect to=\"/\" />\r\n      </Switch>\r\n    );\r\n    if (this.state.isAuth) {\r\n      routes = (\r\n        <Switch>\r\n          <Route\r\n            path=\"/\"\r\n            exact\r\n            render={props => (\r\n              <FeedPage userId={this.state.userId} token={this.state.token} />\r\n            )}\r\n          />\r\n          <Route\r\n            path=\"/:postId\"\r\n            render={props => (\r\n              <SinglePostPage\r\n                {...props}\r\n                userId={this.state.userId}\r\n                token={this.state.token}\r\n              />\r\n            )}\r\n          />\r\n          <Redirect to=\"/\" />\r\n        </Switch>\r\n      );\r\n    }\r\n    return (\r\n      <Fragment>\r\n        {this.state.showBackdrop && (\r\n          <Backdrop onClick={this.backdropClickHandler} />\r\n        )}\r\n        <ErrorHandler error={this.state.error} onHandle={this.errorHandler} />\r\n        <Layout\r\n          header={\r\n            <Toolbar>\r\n              <MainNavigation\r\n                onOpenMobileNav={this.mobileNavHandler.bind(this, true)}\r\n                onLogout={this.logoutHandler}\r\n                isAuth={this.state.isAuth}\r\n              />\r\n            </Toolbar>\r\n          }\r\n          mobileNav={\r\n            <MobileNavigation\r\n              open={this.state.showMobileNav}\r\n              mobile\r\n              onChooseItem={this.mobileNavHandler.bind(this, false)}\r\n              onLogout={this.logoutHandler}\r\n              isAuth={this.state.isAuth}\r\n            />\r\n          }\r\n        />\r\n        {routes}\r\n      </Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(App);\r\n\r\n"]},"metadata":{},"sourceType":"module"}